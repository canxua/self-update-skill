---
name: self-update-skill
description: Skill自更新与持续改进工具。当用户使用 /自更新 命令，或在描述中提到"自更新"、"更新skill"、"优化skill"、"改进skill"等关键词时触发。用于在完成某个skill调用后，收集用户反馈、总结执行经验，深度反思并自动更新目标skill，形成持续改进的闭环。
---

# Self-Update Skill

通过分析skill使用过程中的经验和反馈，自动优化和更新目标skill。

## 执行流程

### 1. 上下文分析

分析当前会话上下文，识别以下信息：

1. **使用过的skills**: 检查会话中调用了哪些skills
2. **执行结果**: skill执行是否成功，输出质量如何
3. **用户反馈**: 用户对执行结果的评价（正面/负面/改进建议）
4. **遇到的问题**: 执行过程中的错误、异常或不理想情况

### 2. 经验提取

从上下文中提取可优化的经验：

- **成功模式**: 哪些做法效果好，值得固化到skill中
- **失败教训**: 哪些情况导致问题，需要在skill中添加预防措施
- **边界情况**: 发现的新场景或边界条件
- **效率改进**: 可以简化或加速的步骤

### 3. 目录结构检查（必须）

检查目标skill的目录结构是否符合规范：

```
skill-name/
├── SKILL.md              # 必须：核心指令文件
├── references/           # 可选：参考文档目录
│   ├── decision-flow.md  #   └─ 决策路径流程图
│   └── *.md              #   └─ 其他参考文档
├── scripts/              # 可选：可执行脚本目录
│   └── *.py / *.ps1      #   └─ 脚本文件
└── assets/               # 可选：输出资源目录
    └── templates/        #   └─ 模板、图片等
```

**检查项**：

| 检查项 | 规则 |
|-------|------|
| 根目录文件 | 只允许 SKILL.md 和 license.txt |
| references/ | 所有参考文档必须在此目录 |
| scripts/ | 所有可执行脚本必须在此目录 |
| assets/ | 所有输出资源必须在此目录 |
| 禁止文件 | README.md, CHANGELOG.md 等辅助文档 |

**如发现不规范结构**：建议重组并移动文件到正确位置。

### 4. 渐进式加载检查（必须）

确保skill符合渐进式加载原则，避免上下文膨胀：

```
加载层级:
Level 1: description (始终在上下文，~100词)
         └─ 包含所有触发条件
         
Level 2: SKILL.md body (触发时加载，<500行)
         └─ 核心流程和指令
         
Level 3: references/* (按需加载，无限制)
         └─ 详细文档，需要时才读取
         
Level 4: scripts/* (执行时加载/直接运行)
         └─ 可不读入上下文直接执行
```

**检查项**：

| 内容类型 | 应放位置 | 加载时机 |
|---------|---------|---------|
| 触发关键词 | description | 始终 |
| 核心执行步骤 | SKILL.md | 触发时 |
| 详细参考信息 | references/*.md | 按需 |
| 决策流程图 | references/decision-flow.md | 按需 |
| 可执行代码 | scripts/*.py | 执行时 |
| 模板/图片 | assets/* | 输出时 |

**优化建议**：
- SKILL.md 超过 500 行 → 拆分到 references/
- 重复代码 → 提取到 scripts/
- 大段示例 → 移到 references/examples.md

### 5. 优化建议生成

基于分析结果，生成具体的优化建议：

```
优化类型:
- 触发条件优化: description中的触发词是否完整
- 流程步骤优化: 执行步骤是否清晰、是否有遗漏
- 目录结构优化: 文件是否放在正确位置
- 渐进式加载优化: 内容是否按需分层
- 错误处理优化: 是否需要添加异常处理指导
- 流程图更新: 同步更新 references/decision-flow.md
```

### 6. 更新执行

1. **定位目标skill**: 根据分析结果找到需要更新的skill路径
2. **检查目录结构**: 确认或修正目录组织
3. **读取当前内容**: 获取SKILL.md和相关文件的当前内容
4. **应用优化**: 按照skill-creator规范更新内容
5. **验证格式**: 确保更新后的内容符合规范
6. **更新流程图**: 同步更新 `references/decision-flow.md`

## 流程图维护规范

### 文件位置

- **路径**: `references/decision-flow.md`（不是根目录！）
- **原因**: 流程图是参考文档，应按需加载，不应与SKILL.md并列

### 流程图格式

使用ASCII决策路径图：

```
用户输入: "[典型问题]"
                │
                ▼
┌─────────────────────────────────────────┐
│  Step 1: [步骤名称]                       │
│  [说明]                                   │
│  ✓ [检查项]                              │
│  → [结果]                                 │
└─────────────────────────────────────────┘
                │
                ▼
              ...
```

### 更新时机

- **流程图不存在**: 必须创建（无论流程是否变更）
- **流程有变更**: 必须更新
- **流程无变更 + 已存在**: 跳过

详细流程图格式和分支示例，见 [references/decision-flow.md](references/decision-flow.md)

## 交互模式

执行自更新时，按以下模式与用户交互：

1. **展示分析结果**: 列出识别到的skills和经验点
2. **目录结构报告**: 指出结构问题和优化建议
3. **渐进式加载报告**: 指出内容分层问题
4. **提出优化建议**: 说明计划进行的优化
5. **确认后执行**: 获得用户确认后再修改文件
6. **展示更新结果**: 说明具体修改了什么内容

## 使用示例

**示例1**: 目录结构优化
```
用户: /自更新
助手: 分析 sonarqube skill...
      
      目录结构问题：
      ❌ workflow.md 在根目录 → 应移至 references/
      ❌ workflow.mmd 在根目录 → 应移至 references/
      ❌ sonarqube.svg 在根目录 → 应移至 assets/
      
      建议重组为：
      sonarqube/
      ├── SKILL.md
      ├── references/
      │   ├── decision-flow.md
      │   ├── workflow.md
      │   └── workflow.mmd
      ├── scripts/
      │   └── *.ps1
      └── assets/
          └── sonarqube.svg
      
      是否执行重组？
```

**示例2**: 渐进式加载优化
```
用户: /自更新
助手: 分析 pdf skill...
      
      渐进式加载问题：
      ⚠️ SKILL.md 有 450 行，接近上限
      ⚠️ 详细示例代码应移至 references/
      
      建议：
      1. 将"高级用法示例"移至 references/examples.md
      2. SKILL.md 只保留核心流程引用
      
      是否执行优化？
```

## 注意事项

- 只更新当前会话中实际使用过的skill
- 保持更新的保守性，避免破坏性修改
- **目录结构必须符合规范**
- **渐进式加载必须得到保证**
- 流程图放在 `references/decision-flow.md`
- 重大变更需明确告知用户并获得确认
- 更新后建议用户测试验证
